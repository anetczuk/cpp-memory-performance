#!/bin/bash

##
## This file is automatically generated from "@GENERATOR_FILE@". Changes will be lost.
##

set -eu

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

cd $SCRIPT_DIR

SCRIPT_NAME=$(basename "$0")
SCRIPT_NAME=${SCRIPT_NAME%.*}


argv=$@

run_benchmark=1
while test $# != 0; do
    case "$1" in
	    --no-benchmark|-nb) run_benchmark=0 ;;
	    *)  ;;
    esac
    shift
done


DATA_DIR="./data"

mkdir -p $DATA_DIR


benchmark_exec=./benchmark_@DATA_TYPE@
raw_data_file=$DATA_DIR/raw_data_@DATA_TYPE@.txt
plot_data_file=$DATA_DIR/plot_data_@DATA_TYPE@.txt

if [ $run_benchmark -ne 0 ]; then
	echo "Generating data"
	$benchmark_exec $argv > $raw_data_file
fi


echo "Extracting data"
awk -F" " '{print $1, $9, $3 $4}' $raw_data_file > $plot_data_file


plot_png="$DATA_DIR/${SCRIPT_NAME}.png"


if [ ! -s "$plot_data_file" ]; then
	echo "No data to plot"
else
	echo "Plotting"
	gnuplot -p -e ' 
	                set title "@PLOT_TITLE@";
	                filenames = "'"$plot_data_file"'";
	                output_png = "'"$plot_png"'"
	              ' plot_config_single.gnu
fi
